<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="anonymous"></script>

<!-- Destination Data (if available) -->
<% if (locals.destination && destination.lat && destination.lng) { %>
    <script>
        window.destinationData = {
            name: "<%- destination.name %>",
            lat: <%= destination.lat || 0 %>,
            lng: <%= destination.lng || 0 %>,
            country: "<%- destination.country || 'Unknown' %>"
        };
    </script>
    <script src="/js/destination.js"></script>
<% } else { %>
    <script src="/js/main.js"></script>
<% } %>

<!-- Global utility functions -->
<script>
// Global function to handle photo loading errors
function handlePhotoError(img) {
    img.src = 'https://via.placeholder.com/200x150/6c757d/ffffff?text=Photo+Unavailable';
    img.alt = 'Photo not available';
    img.style.opacity = '0.8';
    img.style.filter = 'grayscale(50%)';
}

// Global function to focus search input
function focusSearchInput() {
    const searchInput = document.querySelector('input[name="destination"]');
    if (searchInput) {
        searchInput.focus();
        searchInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
}

// Global function to hide location alert
function hideLocationAlert() {
    const alert = document.getElementById('locationAlert');
    if (alert) {
        alert.classList.remove('show');
        alert.classList.add('d-none');
    }
}

// Add this to your scripts.ejs file
document.addEventListener('DOMContentLoaded', function() {
    const photoGallery = document.querySelector('.photo-gallery-grid');
    if (photoGallery) {
        photoGallery.style.display = 'flex';
        photoGallery.style.flexWrap = 'wrap';
        photoGallery.style.gap = '1rem';
        
        const photoItems = document.querySelectorAll('.photo-item');
        photoItems.forEach(item => {
            item.style.flex = '0 0 calc(25% - 0.75rem)';
            item.style.height = '150px';
        });
    }
});


// Initialize photo gallery on page load
document.addEventListener('DOMContentLoaded', function() {
    // Add loading effects to photos
    const photoImages = document.querySelectorAll('.photo-image');
    
    photoImages.forEach((img, index) => {
        // Add loading state
        img.style.opacity = '0';
        img.style.transition = 'opacity 0.3s ease';
        
        // Handle successful load
        img.addEventListener('load', function() {
            setTimeout(() => {
                this.style.opacity = '1';
            }, index * 100); // Stagger the loading animation
        });
        
        // Handle load error
        img.addEventListener('error', function() {
            handlePhotoError(this);
        });
        
        // If image is already cached and loaded
        if (img.complete) {
            setTimeout(() => {
                img.style.opacity = '1';
            }, index * 100);
        }
    });
    
    console.log('Photo gallery initialized');
});

// Global error handling
window.addEventListener('error', function(e) {
    console.warn('JavaScript error:', e.message);
});

// Performance monitoring
window.addEventListener('load', function() {
    if ('performance' in window) {
        setTimeout(() => {
            const loadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
            console.log('Page loaded in:', loadTime + 'ms');
        }, 0);
    }
});

// Network status monitoring
window.addEventListener('online', function() {
    console.log('Back online');
});

window.addEventListener('offline', function() {
    console.log('Gone offline');
});
</script>