<% layout('layouts/boilerplate') %>

<!-- Hero Section -->
<section class="hero-section">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb text-white-50">
                        <li class="breadcrumb-item">
                            <a href="/" class="text-white text-decoration-none">Home</a>
                        </li>
                        <li class="breadcrumb-item active text-white">
                            <%= destination.name %>
                        </li>
                    </ol>
                </nav>
                
                <h1 class="display-4 fw-bold mb-3 text-white">
                    <i class="bi bi-geo-alt me-3"></i>
                    <%= destination.name %>
                </h1>
                
                <p class="lead mb-4 text-white">
                    <%= destination.description %>
                </p>
                
                <div class="d-flex gap-3 flex-wrap">
                    <span class="badge bg-light text-dark fs-6 px-3 py-2">
                        <i class="bi bi-flag me-1"></i>
                        <%= destination.country %>
                    </span>
                    
                    <% if (destination.lat && destination.lng) { %>
                    <span class="badge bg-light text-dark fs-6 px-3 py-2">
                        <i class="bi bi-globe me-1"></i>
                        <%= destination.lat.toFixed(4) %>, <%= destination.lng.toFixed(4) %>
                    </span>
                    <% } %>
                </div>
            </div>
            
            <div class="col-lg-4 mt-4 mt-lg-0">
                <% if (weather) { %>
                <div class="weather-card p-4 text-center">
                    <h5 class="fw-bold mb-3 text-white">
                        <i class="bi bi-thermometer-half me-2"></i>
                        Current Weather
                    </h5>
                    
                    <div class="row g-3">
                        <div class="col-6">
                            <div class="display-6 fw-bold mb-1 text-white">
                                <%= weather.temperature %>Â°C
                            </div>
                            <div class="small text-capitalize text-white">
                                <%= weather.description %>
                            </div>
                        </div>
                        
                        <div class="col-6">
                            <% if (weather.icon) { %>
                            <img src="https://openweathermap.org/img/wn/<%= weather.icon %>@2x.png" 
                                 alt="Weather icon" 
                                 class="weather-icon">
                            <% } %>
                        </div>
                    </div>
                    
                    <div class="row g-3 mt-2 pt-3 border-top border-light">
                        <div class="col-6 text-white">
                            <i class="bi bi-droplet me-1"></i>
                            <%= weather.humidity %>%
                        </div>
                        <div class="col-6 text-white">
                            <i class="bi bi-wind me-1"></i>
                            <%= weather.windSpeed %> m/s
                        </div>
                    </div>
                </div>
                <% } %>
            </div>
        </div>
    </div>
</section>


<!-- Main Content -->
<div class="container py-5">

    <!-- Photo Gallery Section - ALWAYS SHOWS -->
    <section class="mb-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h2 class="fw-bold mb-1">Photo Gallery</h2>
                <p class="text-muted mb-0">Beautiful images from <%= destination.name %></p>
            </div>
            <span class="badge bg-primary fs-6">
                <%= (typeof photos !== 'undefined' && photos) ? photos.length : 0 %> photos
            </span>
        </div>

        <% if (typeof photos !== 'undefined' && photos && photos.length > 0) { %>
            <!-- REAL PHOTOS -->
            <div class="photo-gallery-grid">
                <% photos.forEach(function(photo, index) { %>
                <div class="photo-item">
                    <img src="<%= photo.thumbnail || photo.url %>" 
                         alt="<%= photo.alt || 'Photo ' + (index + 1) %>" 
                         class="photo-image"
                         loading="lazy"
                         onerror="this.src='https://via.placeholder.com/400x300/6c757d/ffffff?text=Image+Not+Available'">
                    
                    <div class="photo-overlay">
                        <button class="btn photo-expand-btn" 
                                data-bs-toggle="modal" 
                                data-bs-target="#photoModal<%= index %>"
                                type="button">
                            <i class="bi bi-arrows-fullscreen"></i>
                        </button>
                    </div>
                </div>

                <div class="modal fade photo-modal" id="photoModal<%= index %>" tabindex="-1">
                    <div class="modal-dialog modal-xl modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title text-white"><%= photo.alt || destination.name + ' - Photo ' + (index + 1) %></h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <img src="<%= photo.url %>" 
                                     alt="<%= photo.alt || 'Photo ' + (index + 1) %>" 
                                     class="modal-image">
                            </div>
                        </div>
                    </div>
                </div>
                <% }); %>
            </div>
        <% } else { %>
            <!-- FALLBACK: Sample photos when no data -->
            <div class="alert alert-info mb-4">
                <i class="bi bi-info-circle me-2"></i>
                No photo data received from backend. Showing sample images:
            </div>
            <div class="photo-gallery-grid">
                <% for(let i = 1; i <= 6; i++) { %>
                <div class="photo-item">
                    <img src="https://picsum.photos/400/300?random=<%= i %>" 
                         alt="Sample Photo <%= i %>" 
                         class="photo-image">
                    <div class="photo-overlay">
                        <button class="btn photo-expand-btn" type="button">
                            <i class="bi bi-arrows-fullscreen"></i>
                        </button>
                    </div>
                </div>
                <% } %>
            </div>
        <% } %>
    </section>

    <!-- Famous Places Section - ALWAYS SHOWS -->
    <section class="mb-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h2 class="fw-bold mb-1">Famous Attractions</h2>
                <p class="text-muted mb-0">Must-visit places in <%= destination.name %></p>
            </div>
            <span class="badge bg-primary fs-6">
                <%= (typeof famousPlaces !== 'undefined' && famousPlaces) ? famousPlaces.length : 0 %> places
            </span>
        </div>

        <% if (typeof famousPlaces !== 'undefined' && famousPlaces && famousPlaces.length > 0) { %>
            <!-- REAL ATTRACTIONS -->
            <div class="row g-4">
                <% famousPlaces.forEach(function(place) { %>
                <div class="col-md-6 col-lg-4">
                    <div class="card attraction-card shadow-sm">
                        <div class="card-body d-flex flex-column">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <h5 class="card-title flex-grow-1 mb-0"><%= place.name %></h5>
                                <% if (place.category) { %>
                                <span class="badge bg-primary ms-2 flex-shrink-0"><%= place.category %></span>
                                <% } %>
                            </div>
                            
                            <% if (place.rating) { %>
                            <div class="mb-3">
                                <% for (let i = 1; i <= 5; i++) { %>
                                <i class="bi bi-star<%= i <= Math.round(place.rating) ? '-fill' : '' %> text-warning"></i>
                                <% } %>
                                <span class="text-muted ms-2">(<%= place.rating %>)</span>
                            </div>
                            <% } %>
                            
                            <% if (place.description) { %>
                            <p class="card-text text-muted mb-3 flex-grow-1"><%= place.description %></p>
                            <% } %>
                            
                            <% if (place.address) { %>
                            <p class="text-muted small mb-3">
                                <i class="bi bi-geo-alt me-2"></i>
                                <%= place.address %>
                            </p>
                            <% } %>

                            <div class="mt-auto">
                                <% if (place.openingHours || place.ticketPrice) { %>
                                <div class="d-flex flex-wrap gap-3 mb-3">
                                    <% if (place.openingHours) { %>
                                    <small class="text-muted">
                                        <i class="bi bi-clock me-1"></i>
                                        <%= place.openingHours %>
                                    </small>
                                    <% } %>
                                    <% if (place.ticketPrice) { %>
                                    <small class="text-success fw-semibold">
                                        <i class="bi bi-ticket me-1"></i>
                                        <%= place.ticketPrice %>
                                    </small>
                                    <% } %>
                                </div>
                                <% } %>

                                <div class="d-flex gap-2">
                                    <% if (place.coordinates) { %>
                                    <a href="https://www.google.com/maps/search/?api=1&query=<%= place.coordinates.lat %>,<%= place.coordinates.lng %>" 
                                       target="_blank" 
                                       class="btn btn-outline-primary btn-sm flex-fill">
                                        <i class="bi bi-map me-1"></i> Map
                                    </a>
                                    <% } %>
                                    
                                    <% if (place.website) { %>
                                    <a href="<%= place.website %>" 
                                       target="_blank" 
                                       class="btn btn-outline-secondary btn-sm flex-fill">
                                        <i class="bi bi-globe me-1"></i> Website
                                    </a>
                                    <% } %>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <% }); %>
            </div>
        <% } else { %>
            <!-- FALLBACK: Sample attractions when no data -->
            <div class="alert alert-info mb-4">
                <i class="bi bi-info-circle me-2"></i>
                No attraction data received from backend. Showing sample attractions:
            </div>
            <div class="row g-4">
                <% for(let i = 1; i <= 3; i++) { %>
                <div class="col-md-6 col-lg-4">
                    <div class="card attraction-card shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title mb-3">Sample Attraction <%= i %></h5>
                            <div class="mb-3">
                                <i class="bi bi-star-fill text-warning"></i>
                                <i class="bi bi-star-fill text-warning"></i>
                                <i class="bi bi-star-fill text-warning"></i>
                                <i class="bi bi-star-fill text-warning"></i>
                                <i class="bi bi-star text-warning"></i>
                                <span class="text-muted ms-2">(4.0)</span>
                            </div>
                            <p class="card-text text-muted">This is a sample attraction. Your backend needs to pass famousPlaces data.</p>
                        </div>
                    </div>
                </div>
                <% } %>
            </div>
        <% } %>
    </section>

    <!-- Explore More -->
    <section class="text-center py-5" style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 16px;">
        <h3 class="fw-bold mb-3">Want to explore another destination?</h3>
        <p class="text-muted mb-4">Search for any city worldwide</p>

        <form action="/search" method="POST" class="d-inline-block">
            <div class="input-group mx-auto" style="max-width: 500px;">
                <input type="text" 
                       class="form-control form-control-lg" 
                       name="destination" 
                       placeholder="Enter city name..." 
                       required>
                <button class="btn btn-primary btn-lg" type="submit">
                    <i class="bi bi-search me-1"></i> Search
                </button>
            </div>
        </form>

        <div class="mt-4">
            <a href="/" class="btn btn-outline-primary">
                <i class="bi bi-house me-1"></i> Back to Home
            </a>
        </div>
    </section>

</div>